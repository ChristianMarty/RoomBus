<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TinyBus</title>
    <link media="print" />
    <link rel="stylesheet" href="https://www.christian-marty.ch/WebPaperLayout/documentTemplate_A4.css">
    <link rel="stylesheet" href="https://www.christian-marty.ch/WebPaperLayout/pageLayout.css">
    <link rel="stylesheet" href="https://www.christian-marty.ch/WebPaperLayout/navigation.css">
    <link rel="stylesheet" href="global.css">
</head>

<script src="https://www.christian-marty.ch/WebPaperLayout/page.js"></script>
<script src="https://www.christian-marty.ch/WebPaperLayout/navigation.js"></script>

<body>

<div class="wpl_navigation">
</div>

<div class="main">
<document-page 
    title="RoomBus" 
    subtitle="System documentation" 
    footer="christian-marty.ch/RoomBus"
    link="https://www.christian-marty.ch/RoomBus/index.html"
>
    <h1>RoomBus</h1>
    <p>RoomBus is a CAN-FD based bus for room monitoring and control.</p>
            
    <h2>Key Features</h2>
    <ul>
        <li>CAN-FD based</li>
        <li>Multi-master</li>
        <li>Up to 125 devices per line</li>
    </ul>

    <h2>Motivation</h2>
    <p>RoomBus was developed as a platform for room control and monitoring applications.</p>

    <h2>Inspiration</h2>
    <p>RoomBus was partially inspired by KNX. However, RoomBus is not intended as a replacement for KNX.</p>

</document-page>

<document-page>
    <h2>Terminology</h2>
    <table>
        <tr>
            <th>RoomBus</th>
            <td>This whole project including the hardware and software layer.</td>
        </tr>
        <tr>
            <th>Kernel</th>
            <td>Part of the firmware that boots the system, handles communication and runs the application.</td>
        </tr>

        <tr>
            <th>Application</th>
            <td>The user application.</td>
        </tr>
    
        <tr>
            <th>Node</th>
            <td>One entity on the bus.</td>
        </tr>
        <tr>
            <th>Frame </th>
            <td>Unit of data on the data link layer.</td>
        </tr>
        <tr>
            <th>Packet</th>
            <td>Unit of data on the network layer.</td>
        </tr>
        <tr>
            <th>Message</th>
            <td>Unit of data on the application layer.</td>
        </tr>
    </table>
    <h3>Requirement Levels</h3>
    <p>Requirement levels are denoted in accordance with <a href="https://www.rfc-editor.org/rfc/rfc2119.html">RFC2119</a>.</p>
    
    <h3>Numbering Format</h3>
    <p>Numbers are represented in decimal format. A complementary representation in an hexadecimal or binary form can be added next to the decimal representation. e.g. 85 (55h / 01010101b).</p>
</document-page>



<document-page>
    <h2>Physical Layer</h2>

    <h3>Connectors and Pinout</h3>
    <p>RoomBus devices should use a 6P6C modular connector (commonly, but incorrectly, often referred to as RJ-12 connector).</p>
    <p>If using a 6P6C modular connector is not feasible in a particular application, a different connector may be used.</p>

    <h4>Pinout</h4>
    <p>In case the 6P6C modular connector is used, the following pinout must be used:</p>
    <img src="connector.png" width="30%">
    <table>
        <tr>
            <th>Pin</th>
            <th>Signal</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>1</td>
            <td>V+</td>
            <td></td>
        </tr>
        <tr>
            <td>2</td>
            <td>V+</td>
            <td></td>
        </tr>
        <tr>
            <td>3</td>
            <td>Bus +</td>
            <td></td>
        </tr>
        <tr>
            <td>4</td>
            <td>Bus -</td>
            <td></td>
        </tr>
        <tr>
            <td>5</td>
            <td>GND</td>
            <td></td>
        </tr><tr>
            <td>6</td>
            <td>GND</td>
            <td></td>
        </tr>
    </table>

    <h4>Bus Power</h4>
    <p>In case the 6P6C modular connector is used, the following specification must be obeyed:</p>
    <p><b>Voltage:</b> 24V DC +/- 20%</p>
    <p><b>Maximum Current:</b> 1A per bus line, 100mA per node</p>
    

    <h2>Data Link Layer</h2>
    <p>RoomBus uses CAN-FD with a 29-bit identifier at a fixed baud rate of 500k-baud.</p>

</document-page>

<document-page>
    <h2>Network Layer</h2>

    <p>RoomBus implements a network protocol on top of the CAN-FD identifier.</p>
    <p>While the identifier is reserved for the network layer, the data part of the CAN-FD frame can be freely used by the application layer.</p>

    <h3>CAN-Identifier</h3>
    <table>
        <tr>
            <th>Bit</th>
            <th>28</th>
            <th>27</th>
            <th>26</th>
            <th>25</th>
            <th>24</th>
            <th>23</th>
            <th>22</th>
            <th>21</th>
            <th>20</th>
            <th>19</th>
            <th>18</th>
            <th>17</th>
            <th>16</th>
            <th>15</th>
            <th>14</th>
            <th>13</th>
            <th>12</th>
            <th>11</th>
            <th>10</th>
            <th>9</th>
            <th>8</th>
            <th>7</th>
            <th>6</th>
            <th>5</th>
            <th>4</th>
            <th>3</th>
            <th>2</th>
            <th>1</th>
            <th>0</th>
        </tr>
        <tr>
            <th>Data</th>
            <td colspan="2">Priority</td>
            <td colspan="7">Source Addresse</td>
            <td colspan="7">Destination Addresse</td>
            <td colspan="6">Protocol Id</td>
            <td colspan="3">Cmd</td>
            <td colspan="4">Length</td>
        </tr>
    </table> 

    <h4>Priority</h4>
    <p>The priority field defines the priority of a frame on the bus.</p>
    <p>As a result of the CAN-bus arbitration, a higher number will result in a lower priority.</p>

    <h5>Priority Levels</h5> 
    <table>
        <tr>
          <th>Id</th>
          <th>Priority</th>
          <th>Description</th>
        </tr>
        <tr>
            <td>0</td>
            <td>Immediate</td>
            <td>Reserved for alerts. Should not be used by applications.</td>
        </tr>
        <tr>
            <td>1</td>
            <td>High</td>
            <td>For low-latency communication.</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Normal</td>
            <td>For normal communication.</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Low</td>
            <td>For file transfer, firmware updates and background tasks.</td>
        </tr>
    </table> 


    <h4>Addressing</h4>
    <p>RoomBus supports an address range of 1 - 126.</p>
    <p><b>Note:</b></p>
    <ul>
        <li>Address 0 (0h) is reserved as production default.</li>
        <li>Address 127 (7Fh) is reserved as broadcast address.</li>
        <li>A broadcast frame will be received and processed by all devices on the bus.</li>
    </ul>

    <h4>Protocol Id</h4>
    <p>The protocol id is a 6-bit (0-63) number that specifies the used application protocol.</p>

    <h4>Command (Cmd)</h4>
    <p>The use of this 3 bits is protocol specific.</p>

    <h4>Length</h4>
    <p>CAN-FD supports data lengths of 0 - 8, 12, 16, 20, 24, 32, 48 or 64 bytes while RoomBus supports 0 - 64 bytes.</p>
    <p>The length field specifies the number of padding bytes to stuff the RoomBus packet length to a CAN-FD frame length.</p>

    <h5>Padding</h5>
    
    <p>CAN-Bus bit stuffing within the padding bytes must be avoided. 170 (AAh / 10101010b) should be used as a padding value.</p>

</document-page>

<document-page>
    <h2>Application Layer</h2>
    <img src="architecture.png" width="100%">

    <h3>Application Header</h3>
    <table>
        <tr>
            <th>Byte</th>
            <th>Content</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0 - 3</td>
            <td>CRC 32</td>
            <td>CRC of the application image</td>
        </tr>
        <tr>
            <td>4 - 7</td>
            <td>Image Size</td>
            <td>Size of the application image</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Major App Revision</td>
            <td>Revision of the application</td>
        </tr>
        <tr>
            <td>9</td>
            <td>Minor App Revision</td>
            <td>Revision of the application</td>
        </tr>
        <tr>
            <td>10-69</td>
            <td>Application Name</td>
            <td>NULL terminated string. In case of 60 characters, NULL can be omitted</td>
        </tr>
        <tr>
            <td>70-73</td>
            <td>Application Main Address</td>
            <td>Application main function entry point address</td>
        </tr>
        <tr>
            <td>74-77</td>
            <td>Application Data Received Address</td>
            <td>Application data received function entry point address</td>
        </tr>
    </table>
    <p>All multi-byte values are stored in little-endian (MSB first) order.</p>

    <h3>Administration Mode</h3>
    <p>The administration mode is a privileged mode that must be entered for system critical configuration changes on a device.</p>
    <p>The administration mode can be activated by sending the “Enter Administration Mode” instruction or pressing the administration button on the device.</p>

    <p>Entering the administration mode will trigger a "System Information" message.</p>
</document-page>

<document-page>
    <h2>Application Layer Protocol</h2>
    <p>The application layer defines protocols for handling different types of Applications.</p>
    <table>
        <tr>
          <th>Id</th>
          <th>Protocol</th>
          <th>Description</th>
        </tr>
        <tr>
            <td>0</td>
            <td>Device Management Protocol</td>
            <td>The Device Management Protocol provides a basic set of instructions to manage basic device function and to transfer software (Bootloader) and data (File System) to or from the device.</td>
        </tr>
        <tr>
            <td>1</td>
            <td>Sys Msg / Logging</td>
            <td>Allows to send text based messages from the device to e.g. a logging server.</td>
        </tr>
        <tr>
            <td>2</td>
            <td>File Transfer Protocol </td>
            <td>Allows to access the file system of the device.</td>
        </tr>
        <tr>
            <td>3-7</td>
            <td>Reserved for Kernel</td>
            <td></td>
        </tr>
        <tr>
            <td>8</td>
            <td>Trigger System Protocol</td>
            <td></td>
        </tr>
        <tr>
            <td>9</td>
            <td>Event System Protocol</td>
            <td>The Event System Protocol is used to trigger and report actions on a device.</td>
        </tr>
        <tr>
            <td>10</td>
            <td>State Report Protocol</td>
            <td></td>
        </tr>
        <tr>
            <td>11</td>
            <td>Value Report Protocol</td>
            <td></td>
        </tr>
        <tr>
            <td>12</td>
            <td>Serial Bridge Protocol</td>
            <td>Allowes serial comunication over the BUS</td>
        </tr>
        <tr>
            <td>13-62</td>
            <td>Reserved</td>
            <td></td>
        </tr>
        <tr>
            <td>63</td>
            <td>Protocol No. extension</td>
            <td>Additional 8bits (following Byte) are added to the Protocol No. size.</td>
        </tr>
    </table>  
    <h3>Protocol Conventions</h3>
    <p>Every application protocol should follow the following conventions if possible:</p>
    <p>TBD</p>
</document-page>

<document-page>
    <h3>Device Management Protocol (ID 0x00)</h3>
    <p>The device management functionality must be completely implemented on all devices.</p>
    <h4>Commands</h4>
    <li>0x00 – Device to Host Communication</li>
    <li>0x01 – Host to Device Communication</li>

    <h4>Instruction List</h4>
    <table>
        <tr>
          <th>Id</th>
          <th>Instruction</th>
          <th>Payload</th>
          <th>Response</th>
        </tr>
        <tr>
            <td>0x00</td>
            <td>Heartbeat</td>
            <td>Status</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x01</td>
            <td>System Information </td>
            <td>System Information </td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x02</td>
            <td>Hardware Name</td>
            <td>String</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x03</td>
            <td>Application Name</td>
            <td>String</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x04</td>
            <td>Device Name</td>
            <td>String</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x05</td>
            <td>Heartbeat request</td>
            <td>Empty</td>
            <td>Heartbeat</td>
        </tr>
        <tr>
            <td>0x06</td>
            <td>System Information Request</td>
            <td>Empty</td>
            <td>System Info +
                Hardware Name +
                Application Name +
                Device Name</td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>0x08</td>
            <td>Heartbeat Settings</td>
            <td>Heartbeat parameter</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x09</td>
            <td>Write Control</td>
            <td>Control Byte</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x0A</td>
            <td>Set Control</td>
            <td>Control Byte</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x0B</td>
            <td>Clear Control</td>
            <td>Control Byte</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x0C</td>
            <td>Enter Administration Mode</td>
            <td>Password</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x0D</td>
            <td>Set Device Name*</td>
            <td>New Device Name</td>
            <td>-</td>
        </tr>
        <tr>
            <td>0x0E</td>
            <td>Set Address*</td>
            <td>New Address</td>
            <td>-</td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>0xF0</td>
            <td>Diagnostics Request</td>
            <td>Empty</td>
            <td>Diagnostics Report</td>
        </tr>
        <tr>
            <td>0xF1</td>
            <td>Diagnostics Report</td>
            <td>Diagnostics  Report</td>
            <td>Empty</td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>

        <tr>
            <td>0xFA</td>
            <td>Echo</td>
            <td>Echo Data</td>
            <td>Echo</td>
        </tr>
        <tr>
            <td>0xFB</td>
            <td>Reboot*</td>
            <td>Empty</td>
            <td></td>
        </tr>
        <tr>
            <td>0xFC</td>
            <td>Erase App*</td>
            <td>Empty</td>
            <td></td>
        </tr>
        <tr>
            <td>0xFD</td>
            <td>Erase App Response*</td>
            <td>Empty</td>
            <td></td>
        </tr>
        <tr>
            <td>0xFE</td>
            <td>Bootload*</td>
            <td>Address + Data</td>
            <td>Bootload Response</td>
        </tr>
        <tr>
            <td>0xFF</td>
            <td>Bootload Response*</td>
            <td>Address + Data Size</td>
            <td>-</td>
        </tr>
    </table>  
    <p>*) The device must be in administration mode to execute these instructions.</p>
</document-page>

<document-page>
    <h4>Heartbeat (0x00)</h4>
    <p>A heartbeat messages will be sent periodically to signal the devices presence on the BUS. The Heartbeat message contains the Status Byte.</p>

    <h4>System Information</h4> 
    <table>
        <tr>
          <th>Data</th>
          <th>Data Type</th>
          <th>Size</th>
        </tr>
        <tr>
            <td>Status</td>
            <td>32-Bit Integer</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>Hardware Version</td>
            <td>Integer (Major Byte, Minor Byte)</td>
            <td>2 Byte</td>
        </tr>
        <tr>
            <td>Kernel Version</td>
            <td>Integer (Major Byte, Minor Byte)</td>
            <td>2 Byte</td>
        </tr>
        <tr>
            <td>Heartbeat Interval</td>
            <td>Integer</td>
            <td>2 Byte</td>
        </tr>
        <tr>
            <td>Extended Heartbeat Interval</td>
            <td>Integer</td>
            <td>2 Byte</td>
        </tr>
        <tr>
            <td>App CRC</td>
            <td>32-Bit Integer</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>App Start Address</td>
            <td>32-Bit Intege</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>Device Id</td>
            <td>32-Bit Intege</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>Device Serial Number Word 0</td>
            <td>32-Bit Intege</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>Device Serial Number Word 1</td>
            <td>32-Bit Intege</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>Device Serial Number Word 2</td>
            <td>32-Bit Intege</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>Device Serial Number Word 3</td>
            <td>32-Bit Intege</td>
            <td>4 Byte</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h4>Hardware Name / Application Name / Device Name (0x02 / 0x03 / 0x04)</h4>
    <p>The name is encoded as ASCII string. The length is limited to 60 characters.</p>
    <p>The Name is not NULL terminated.</p>

    <h4 id="SystemInformationRequest(0x06)">System Information Request (0x06)</h4>
    <p>The System Information request will trigger a Extended Heartbeat Package.</p>

    <h4>Heartbeat Settings (0x08)</h4>
    <p>The Heartbeat Settings define the interval Heartbeat messages are sent.</p>
    <table>
        <tr>
          <th>Data</th>
          <th>Description</th>
          <th>Data Type</th>
          <th>Size</th>
        </tr>
        <tr>
            <td>Heartbeat Interval</td>
            <td>Time in 1 second steps, 0 = off</td>
            <td>16-Bit Integer</td>
            <td>2 Byte</td>
        </tr>
        <tr>
            <td>Extended Heartbeat Interval </td>
            <td>Time in 10 second steps, 0 = off</td>
            <td>16-Bit Integer)</td>
            <td>2 Byte</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h4>Messages</h4>
    <h5>Status</h5>

    <table>
        <tr>
            <th>Bit</th>
            <th>31</th>
            <th>30</th>
            <th>29</th>
            <th>28</th>
            <th>27</th>
            <th>26</th>
            <th>25</th>
            <th>24</th>
        </tr>
        <tr>
            <td></td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>    
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <th>Bit</th>
            <th>23</th>
            <th>22</th>
            <th>21</th>
            <th>20</th>
            <th>19</th>
            <th>18</th>
            <th>17</th>
            <th>16</th>
        </tr>
        <tr>
            <td></td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>    
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <th>Bit</th>
            <th>15</th>
            <th>14</th>
            <th>13</th>
            <th>12</th>
            <th>11</th>
            <th>10</th>
            <th>9</th>
            <th>8</th>
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <td></td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>Watchdog Error</td>
            <td>Watchdog Warning</td>    
        </tr>

        <tr><td style="border: none;"></td></tr>
        <tr>
            <th>Bit</th>
            <th>7</th>
            <th>6</th>
            <th>5</th>
            <th>4</th>
            <th>3</th>
            <th>2</th>
            <th>1</th>
            <th>0</th>
        </tr>
        <tr>
            <td></td>
            <td>System Error Flag</td>
            <td>-</td>
            <td>Setup Mode Flag</td>
            <td>Identify Flag</td>
            <td>LEDs On /Off</td>
            <td>Run App on startup</td>
            <td>App CRC</td>
            <td>App Running</td>    
        </tr>
    </table>

    <h5>Control</h5>

    <table>
        <tr>
            <th>Bit</th>
            <th>31</th>
            <th>30</th>
            <th>29</th>
            <th>28</th>
            <th>27</th>
            <th>26</th>
            <th>25</th>
            <th>24</th>
        </tr>
        <tr>
            <td></td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>    
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <th>Bit</th>
            <th>23</th>
            <th>22</th>
            <th>21</th>
            <th>20</th>
            <th>19</th>
            <th>18</th>
            <th>17</th>
            <th>16</th>
        </tr>
        <tr>
            <td></td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>    
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <th>Bit</th>
            <th>15</th>
            <th>14</th>
            <th>13</th>
            <th>12</th>
            <th>11</th>
            <th>10</th>
            <th>9</th>
            <th>8</th>
        </tr>
        <tr>
            <td></td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>Force App Shutdown</td>
            <td>Reboot System</td>
            <td>Reboot App</td>    
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <th>Bit</th>
            <th>7</th>
            <th>6</th>
            <th>5</th>
            <th>4</th>
            <th>3</th>
            <th>2</th>
            <th>1</th>
            <th>0</th>
        </tr>
        <tr>
            <td></td>
            <td>System Error Flag</td>
            <td>-</td>
            <td>-</td>
            <td>Identify</td>
            <td>LEDs On /Off</td>
            <td>Run App on startup</td>
            <td>Check App CRC</td>
            <td>Run App</td>    
        </tr>
    </table>
</document-page>

<document-page>
    <h4>Diagnostics Request (0xF0)</h4>
    <h4>Diagnostics Report (0xF1)</h4>
    <table>
        <tr>
          <th>Data</th>
          <th>Data Type</th>
          <th>Size</th>
        </tr>
        <tr>
            <td>Bus Error Counter</td>
            <td>24-Bit Integer</td>
            <td>3 Byte</td>
        </tr>
        <tr>
            <td>Last Error Code</td>
            <td>Byte</td>
            <td>1 Byte</td>
        </tr>
        <tr>
            <td>App Time (Avg [us])</td>
            <td>32-Bit Integer</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>App Time (Min [us])</td>
            <td>32-Bit Integer</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>App Time (Max [us])</td>
            <td>32-Bit Integer</td>
            <td>4 Byte</td>
        </tr>
    </table>

    <h4>Echo (0xFA)</h4>
    <p>The Echo Instruction will return a received payload back to the sender.</p>
    <p>The intended use case for this instruction is to test the connection between devices.</p>

    <h4>Reboot* (0xFB)</h4>
    <p>This instruction will shutdown the app and restart the device.</p>
</document-page>

<document-page>
    <h4>Erase App* (0xFC)</h4>
    <p>This command will stop the execution of the application and erase the application section in the device memory.</p>

    <h4>Erase App Response* (0xFD)</h4>
    <p>This instruction will be sent by the device after the erasing process is completed.</p>

    <h4>Bootload Write* (0xFE)</h4>
    <p>This istruction code is used to send the application image to the device.</p>
    <table>
        <tr>
          <th>Data</th>
          <th>Data Type</th>
          <th>Size</th>
        </tr>
        <tr>
            <td>Address Offset</td>
            <td>32-Bit Integer</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>Data</td>
            <td>n Byte</td>
            <td>0 - 2 Byte</td>
        </tr>
    </table>


    <h4>Bootload Response* (0xFF)</h4>
    <p>Once a Bootload Write instruction is completed, theis reponce will be sent.</p>
    <table>
        <tr>
          <th>Data</th>
          <th>Data Type</th>
          <th>Size</th>
        </tr>
        <tr>
            <td>Address Offset</td>
            <td>32-Bit Integer</td>
            <td>4 Byte</td>
        </tr>
        <tr>
            <td>Number of bytes written</td>
            <td>Byte</td>
            <td>1 Byte</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h3>System Message and Logging Protocol (ID 0x01)</h3>
    <p>This protocol allows to send text messages for logging and diagnostic purposes from the device.</p>
    <h4>Commands</h4>
    <li>0x00 – System Message</li>
    <li>0x01 – System Warning Message</li>
    <li>0x02 – System Error Message</li>
    <li>0x03 – Reserved</li>
    <li>0x04 – Application Message</li>
    <li>0x05 – Application Warning Message</li>
    <li>0x06 – Application Error Message</li>
    <li>0x07 – Reserved</li>
    <h4>Payload</h4>
    <p>Byte 0 - 1 is reserved. Those bytes must be set to 0.</p>
    <p>Byte 2 - 63 can be used for the message.</p>
    <table>
        <tr>
            <th>Byte</th>
            <th>0</th>
            <th>1</th>
            <th>2 ... 63</th>
        </tr>
        <tr>
            <th>Data</th>
            <td colspan="2" >Reserved</td>
            <td colspan="16" >Message</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h3>File Transfer Protocol (ID 0x02)</h3>
    <h4>Commands</h4>
    <li>0x00 – Command – Host to Device Communication</li>
    <li>0x01 – Response – Device to Host Communication</li>
    <li>0x02 – Reserved</li>
    <li>0x03 – Reserved</li>
    <li>0x04 – Data Transfer from Device</li>
    <li>0x05 – From Device Ack </li>
    <li>0x06 – Data Transfer to Device</li>
    <li>0x07 – To Device  Ack</li>

    <h5>Command (0x00)</h5>
    <table>
        <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Payload</th>
            <th>Response</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0x00</td>
            <td>List content</td>
            <td>Path</td>
            <td>File Info</td>
            <td></td>
        </tr>
        <tr>
            <td>0x01</td>
            <td>Get space Information</td>
            <td>Path</td>
            <td></td>
            <td>Not implemented</td>
        </tr>
        <tr>
            <td>0x02</td>
            <td>Get File Information</td>
            <td>Path</td>
            <td></td>
            <td>Not implemented</td>
        </tr></td>
        </tr>

        <tr><td style="border: none;"></td></tr>
        <tr>
            <td>0x08</td>
            <td>Make File</td>
            <td>Path</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>0x09</td>
            <td>Delete File</td>
            <td>Path</td>
            <td></td>
            <td></td>
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <td>0x20</td>
            <td>Start File Read</td>
            <td>Path</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>0x21</td>
            <td>End File Read</td>
            <td>Path</td>
            <td></td>
            <td></td>
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <td>0x30</td>
            <td>Start File Write</td>
            <td>Path</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>0x31</td>
            <td>End File Write</td>
            <td>Path</td>
            <td></td>
            <td></td>
        </tr>
    </table>

    <h5>Response (0x01)</h5>
    <table>
        <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Payload</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0x00</td>
            <td>File Info</td>
            <td>File Info</td>
            <td></td>
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <td>0x20</td>
            <td>Start File Read Acknowledgment</td>
            <td>Path</td>
            <td></td>
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <td>0x30</td>
            <td>Start File Write Acknowledgment</td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td>0x31</td>
            <td>Complete File Write Acknowledgment</td>
            <td></td>
            <td></td>
        </tr>
    </table>
    <p></p>
    <img src="FileTransferProtocol.png" alt="File Transfer Protocol" style="width:100%;">

</document-page>

<document-page>
    <h5>File Info Response</h5>
    <table>
        <tr>
            <th colspan="9">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7-57</th>
            <th>58-62</th>
        </tr>
        <tr>
            <td>Code (0x00)</td>
            <td>Status</td>
            <td>Type</td>
            <td colspan="4">File Size</td>
            <td>Path</td>
            <td>Reserved</td>
        </tr>
    </table>

    <h5>Status</h5>
    <table>
        <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0x00</td>
            <td>ftp_rsps_ok</td>
            <td></td>
        </tr>
        <tr>
            <td>0x01</td>
            <td>ftp_rsps_pathInvalid</td>
            <td></td>
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <td>0x20</td>
            <td>ftp_rsps_writeSuccessful</td>
            <td></td>
        </tr>
        <tr>
            <td>0x21</td>
            <td>ftp_rsps_writeCrcError</td>
            <td></td>
        </tr>
        <tr>
            <td>0x22</td>
            <td>ftp_rsps_writeSequencingError</td>
            <td></td>
        </tr>
        <tr><td style="border: none;"></td></tr>
        <tr>
            <td>0x30</td>
            <td>ftp_rsps_readSuccessful</td>
            <td></td>
        </tr>
        <tr>
            <td>0x31</td>
            <td>ftp_rsps_readCrcError</td>
            <td></td>
        </tr>
        <tr>
            <td>0x32</td>
            <td>ftp_rsps_readSequencingError</td>
            <td></td>
        </tr>
    </table>

    <h5>Data Transfer from Device (0x04) / Data Transfer to Device (0x06)</h5>
    <table>
        <tr>
            <th colspan="5">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4-n</th>
        </tr>
        <tr>
            <td colspan="4">Data Offset</td>
            <td>Data</td>
        </tr>
    </table>

    <h5>From Device Acknowledgment (0x05) / To Device Acknowledgment (0x07)</h5>
    <table>
        <tr>
            <th colspan="1">Byte</th>
        </tr>
        <tr>
            <th>0</th>
        </tr>
        <tr>
            <td>Status</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h3>Event System Protocol (ID 0x09)</h3>
    <h4>Commands </h4>
    <li>0x00 – Event Slot</li>
    <li>0x01 – Event Signal Name Reporting</li>
    <li>0x02 – Event Slot Name Reporting</li>
    <li>0x03 – Event Signal Name Request</li>
    <li>0x04 – Event Slot Name Request</li>
    <li>0x05 – Event Timeout Reset Request</li>
    <li>0x06 – Reserved</li>
    <li>0x07 – Reserved</li>

    <h4>Event Slot (0x00)</h4>
    <p>The event slot message contains a list channels of currently active events.</p>
    <table>
        <tr>
            <th>Byte</th>
        </tr>
        <tr>
            <th>n</th>
        </tr>
        <tr>
            <td>Event Channel Number</td>
        </tr>
    </table>

    <h4>Event Signal Name Reporting (0x01)</h4>
    <table>
        <tr>
            <th colspan="3">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1</th>
            <th>2-n</th>
        </tr>
        <tr>
            <td>Destination Address</td>
            <td>Event Channel Nr</td>
            <td>Channel Name</td>
        </tr>
    </table>
  
    <h4>Event Slot Name Reporting (0x02)</h4>
    <table>
        <tr>
            <th colspan="5">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4-n</th>
        </tr>
        <tr>
            <td>Source Address</td>
            <td>Event Channel Nr</td>
            <td colspan="2" >Timeout</td>
            <td>Channel Name</td>
        </tr>
    </table>

    <h4>Event Signal Name Request (0x03) / Event Slot Name Request (0x04)</h4>
    <table>
        <tr>
            <th>Byte</th>
        </tr>
        <tr>
            <th>n</th>
        </tr>
        <tr>
            <td>Event Channel Number</td>
        </tr>
    </table>

    <h4>Event Timeout Reset Request (0x05)</h4>
    <p>This command resets the event repetition timeout counter. All currently active events will be reported.</p>
    <table>
        <tr>
            <th colspan="5">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4-n</th>
        </tr>
        <tr>
            <td>Source Address</td>
            <td>Event Channel Nr</td>
            <td colspan="2" >Timeout</td>
            <td>Channel Name</td>
        </tr>
    </table>

</document-page>

<document-page>
    <h3>Trigger System Protocol (ID 0x08)</h3>
    <h4>Commands </h4>
    <li>0x00 – Trigger Slot</li>
    <li>0x01 – Trigger Signal Name Reporting</li>
    <li>0x02 – Trigger Slot Name Reporting</li>
    <li>0x03 – Trigger Signal Name Request</li>
    <li>0x04 – Trigger Slot Name Request</li>
    <li>0x05 – Reserved</li>
    <li>0x06 – Reserved</li>
    <li>0x07 – Reserved</li>

    <h4>Trigger Slot (0x00)</h4>
    <table>
        <tr>
            <th>Byte</th>
        </tr>
        <tr>
            <th>n</th>
        </tr>
        <tr>
            <td>Trigger Channel Number</td>
        </tr>
    </table>

    <h4>Trigger Signal Name Reporting (0x01)</h4>
    <table>
        <tr>
            <th colspan="3">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1</th>
            <th>2-n</th>
        </tr>
        <tr>
            <td>Destination Address</td>
            <td>Event Channel Nr</td>
            <td>Channel Name</td>
        </tr>
    </table>
  
    <h4>Trigger Slot Name Reporting (0x02)</h4>
    <table>
        <tr>
            <th colspan="5">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4-n</th>
        </tr>
        <tr>
            <td>Source Address</td>
            <td>Event Channel Nr</td>
            <td colspan="2" >Timeout</td>
            <td>Trigger Channel Name</td>
        </tr>
    </table>
    <h4>Trigger Signal Name Request (0x03) / Trigger Slot Name Request (0x04)</h4>
    <table>
        <tr>
            <th>Byte</th>
        </tr>
        <tr>
            <th>n</th>
        </tr>
        <tr>
            <td>Trigger Channel Number</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h3>State Report Protocol (ID 0x0A)</h3>
    <h4>Commands </h4>
    <li>0x00 – Group 0 Report (Channels 0-127)</li>
    <li>0x01 – Group 1 Report (Channels 128-255)</li>
    <li>0x02 – Reserved</li>
    <li>0x03 – Reserved</li>
    <li>0x04 – Individual State Report</li>
    <li>0x05 – State Report Request</li>
    <li>0x06 – State Report Channel Name Reporting</li>
    <li>0x07 – State Report Channel Name Request</li>

    <h4>Group 0 Report (0x00) / (0x01)</h4>
    <table>
        <tr>
            <th colspan="3">Byte</th>
        </tr>
        <tr>
            <th colspan="3">n</th>
        </tr>
        <tr>
            <th>Bit</th>
            <th>7:4</th>
            <th>3:0</th>
        </tr>
        <tr>
            <td></td>
            <td>Channel 0+n*2</td>
            <td>Channel 1+n*2</td>
        </tr>
    </table>

    <h5>State</h5>
    <table>
        <tr>
            <th>Code</th>
            <th>Name</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0</td>
            <td>Off</td>
            <td></td>
        </tr>
        <tr>
            <td>1</td>
            <td>On</td>
            <td></td>
        </tr>
        <tr>
            <td>2</td>
            <td>Transitioning</td>
            <td>State is transitioning from On to Off</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Undefined / Error</td>
            <td>State is unclear or error</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h3>Value Report Protocol (ID 0x0B)</h3>

    <h4>Value Reporting (0x00)</h4>
    <table>
        <tr>
            <th colspan="6">Byte</th>
        </tr>
        <tr>
            <th></th>
            <th >0</th>
            <th colspan="2">1</th>
            <th >2-5</th>
        </tr>
        <tr>
            <th>Bit</th>
            <th>7:0</th>
            <th>7:4</th>
            <th>3:0</th>
            <th>7:0</th>
        </tr>
        <tr>
            <td></td>
            <td colspan="2">Channel Nr</td>
            <td>Data Type</td>
            <td>Value</td>
        </tr>
    </table>

    <h4>Value Command (0x01)</h4>
    <table>
        <tr>
            <th colspan="6">Byte</th>
        </tr>
        <tr>
            <th></th>
            <th >0</th>
            <th colspan="2">1</th>
            <th >2-5</th>
        </tr>
        <tr>
            <th>Bit</th>
            <th>7:0</th>
            <th>7:4</th>
            <th>3:0</th>
            <th>7:0</th>
        </tr>
        <tr>
            <td></td>
            <td colspan="2">Channel Nr</td>
            <td>Data Type</td>
            <td>Value</td>
        </tr>
    </table>

    <h5>Commands</h5>
    <table>
        <tr>
            <th>Index</th>
            <th>Description</th>
            <th>Has Data</th>
        </tr>
        <tr>
            <td>0</td>
            <td>Set value to minimum</td>
            <td>-</td>
        </tr>
        <tr>
            <td>1</td>
            <td>Set value to maximum</td>
            <td>-</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Invert / Complement</td>
            <td>-</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Set to value x</td>
            <td>x</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Add int 8 x</td>
            <td>x</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Add int 16 x</td>
            <td>x</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Add int 32 x</td>
            <td>x</td>
        </tr>
        <tr>
            <td>7</td>
            <td>Add int 64 x</td>
            <td>x</td>
        </tr>

        <tr>
            <td></td>
            <td>Bitweise AND </td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td>Bitweise OR </td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td>Bitweise XOR </td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td>Bitweise Invert </td>
            <td></td>
        </tr>
    </table>

    <h4>Meta Data Reporting (0x02)</h4>
    <table>
        <tr>
            <th colspan="6">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th colspan="2">1</th>
            <th>2-5</th>
            <th>6-9</th>
            <th>10-n</th>
        </tr>
        <tr>
            <th>7:0</th>
            <th>7</th>
            <th>6:0</th>
            <th>7:0</th>
            <th>7:0</th>
            <th>7:0</th>
        </tr>
        <tr>
            <td>Channel Nr</td>
            <td>RO</td>
            <td>UoM</td>
            <td>Min Value</td>
            <td>Max Value</td>
            <td>Name</td>
        </tr>
    </table>

    <h4>Value Request (0x03) / Meta Data Request (0x04)</h4>
    <p>If no channel number is specified, a report for all channels is returned</p>
    <table>
        <tr>
            <th>Byte</th>
            <th>n</th>
        </tr>
        <tr>
            <td></td>
            <td>Channel Nr</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h3>Serial Bridge Protocol (ID 0x0C)</h3>
    <h4>Commands </h4>
    <li>0x00 – Data</li>
    <li>0x01 – Reserved</li>
    <li>0x02 – Reserved</li>
    <li>0x03 – Reserved</li>
    <li>0x04 – Port Info Report</li>
    <li>0x05 – Port Info Request</li>
    <li>0x06 – Reserved</li>
    <li>0x07 – Reserved</li>

    <h4>Data (0x00) OLD</h4>
    <table>
        <tr>
            <th colspan="9">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
            <th>8-n</th>
        </tr>
        <tr>
            <td colspan="4" >Source Port No</td>
            <td colspan="4" >Destination Port No</td>
            <td>Data</td>
        </tr>
    </table>

    <h4>Data (0x00) </h4>
    <table>
        <tr>
            <th colspan="9">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1</th>
            <th>2-n</th>

        </tr>
        <tr>
            <td>Port</td>
            <td>Status</td>

            <td>Data</td>
        </tr>
    </table>

    <h4>Port Info Report (0x04)</h4>
    <table>
        <tr>
            <th colspan="2">Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <th>1-n</th>
        </tr>
        <tr>
            <td>Number of Ports</td>
            <td>Port Information</td>
        </tr>
    </table>

    <h5>Port Information</h5>
    <table>

        <tr>
            <th>Code</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0x00</td>
            <td>UART (Serial Port)</td>
            <td></td>
        </tr>
        <tr>
            <td>0x01</td>
            <td>I2C</td>
            <td></td>
        </tr>
    </table>

    <h4>Port Info Request (0x05)</h4>
    <p>This command will return a list of available ports. The Data field is empty.</p>
</document-page>

<document-page>
    <h2>Datatypes</h2>
    <p>The following sections will explain what data types can be used in the protocol and how the data is formatted.</p>
    
    <table>
        <tr>
          <th>Name</th>
          <th>C++ equivalent</th>
          <th>Description</th>
          <th>Encoding</th>
        </tr>
        <tr>
          <td>Bool</td>
          <td>Bool</td>
          <td>True or False </td>
          <td>True -> 0x01, False -> 0x00</td>
        </tr>
        <tr>
          <td>String</td>
          <td>String</td>
          <td>ANSI String</td>
          <td>Hallo Welt &lt NULL &gt</td>
        </tr>
        <tr>
            <td>Integer</td>
            <td>Unsigned Int</td>
            <td>A unsigned 16 bit number</td>
            <td>&ltH Byte&gt&ltL Byte&gt</td>
        </tr>
        <tr>
            <td>Byte</td>
            <td>Unsigned Char</td>
            <td>A unsigned 8 bit number</td>
            <td>&ltByte&gt</td>
        </tr>
        <tr>
            <td>sInteger</td>
            <td>Signed Int</td>
            <td>A signed 16 bit number</td>
            <td>&ltH Byte&gt&ltL Byte&gt</td>
        </tr>
        <tr>
            <td>sByte</td>
            <td>Signed Char</td>
            <td>A signed 8 bit number</td>
            <td>&ltByte&gt</td>
        </tr>
        <tr>
            <td>Number</td>
            <td>float</td>
            <td>A 32-Bit floating point number</td>
            <td>&ltMSB Byte&gt&lt2. Byte&gt&lt3. Byte&gt&ltLSB Byte&gt</td>
        </tr>
      </table> 
    
      <h2>Setup Mode</h2>
      <p>
        The Setup Mode is used to set the Address of a Device. The Setup Mode can be entered ether by a command over the Device Management Protocol or by a physical interaction with the Hardware (Usually press of a Button). </p>
        <p>The Device Address can only be changed if the device is in Setup Mode. </p><p>
    After entering Setup Mode a Heartbeat massage will be send, were the Setup Mode Flag is set.  
    After a new Address is received, the devise will automatically leave the Setup Mode and reboot.
      </p>
</document-page>

<document-page>
    <h2>Unit of Measurements</h2>
    <table>
        <tr>
            <th>UoM Code</th>
            <th>Symbol</th>
            <th>Description</th>
            <th>Data Type</th>
            <th>Size [Byte]</th>
            <th>Note</th>
        </tr>
        <tr>
            <td>0x00</td>
            <td></td>
            <td>Raw Data</td>
            <td>uint32</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x01</td>
            <td></td>
            <td>Digital I/O</td>
            <td>Boolean</td>
            <td>1</td>
            <td>0x00 Off, 0x01 On, 0x02 Transitioning</td>
        </tr>
        <tr>
            <td>0x02</td>
            <td></td>
            <td>Absolute Time</td>
            <td>uint32</td>
            <td>4</td>
            <td>Unix time as 32 bit unsigned int</td>
        </tr>
        <tr>
            <td>0x03</td>
            <td>s</td>
            <td>Relative Time</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x04</td>
            <td>°C</td>
            <td>Temperature</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x05</td>
            <td>%</td>
            <td>Rel. Humidity</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x06</td>
            <td>kPa</td>
            <td>Pressure</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x07</td>
            <td>V</td>
            <td>Voltage</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x08</td>
            <td>A</td>
            <td>Current</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x09</td>
            <td>W</td>
            <td>Power</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x0A</td>
            <td></td>
            <td>Power Factor</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x0B</td>
            <td>Hz</td>
            <td>Frequency</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x0C</td>
            <td>kWh</td>
            <td>Energy</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x0D</td>
            <td>Ω</td>
            <td>Resistance</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x0E</td>
            <td>F</td>
            <td>Capacitance</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x0F</td>
            <td>N</td>
            <td>Force</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x10</td>
            <td>kg</td>
            <td>Weight</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x11</td>
            <td>m</td>
            <td>Length</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
        <tr>
            <td>0x12</td>
            <td>m/s</td>
            <td>Speed</td>
            <td>Float</td>
            <td>4</td>
            <td></td>
        </tr>
    </table>
</document-page>

<document-page>
    <h2>Led Color Codes</h2>
    <li>Red: Data Received and processed</li>
    <li>Green: Data Transmit</li>
    <li>Blue: Setup Mode or Remote Debug Mode is enabled</li>

    <h2>Firmware Header</h2>
    <table>
        <tr>
            <th>Byte</th>
            <th>Content</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0 - 3</td>
            <td>CRC 32</td>
            <td>CRC of the application image</td>
        </tr>
        <tr>
            <td>4 - 7</td>
            <td>Image Size</td>
            <td>Size of the application image</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Major App Revision</td>
            <td>Revision of the application</td>
        </tr>
        <tr>
            <td>9</td>
            <td>Minor App Revision</td>
            <td>Revision of the application</td>
        </tr>
        <tr>
            <td>10-69</td>
            <td>Application Name</td>
            <td>NULL Terminated String. Max 60 Characters including NULL</td>
        </tr>
        <tr>
            <td>70-73</td>
            <td>Application Main Address</td>
            <td>Application Main function entry point address</td>
        </tr>
        <tr>
            <td>74-77</td>
            <td>Application Data Receive Address</td>
            <td>Application Data Receive function entry point address</td>
        </tr>
    </table>
</document-page>



<document-page>

</document-page>

<document-page>
    <h1> OLD </h1>
</document-page>

<document-page>
    <h2>Topology</h2>
    <p>The TinyBus is a strictly master-slave, request-response based protocol.</p>
    <p>TinyBus is conceived to be single-master, however, multi-master operation is technically feasible.</p>

    <h3>Addressing</h3>
    <p>The TinyBus supports up to 14 individually addressable devices.</p>
    <p>Additionally, all nodes can be commanded simultaneously via a broadcast address.</p>
    
    <h3>Baud Rates</h3>
    <p>Each TinyBus node must support auto-baud detection. 
        Therefore, there is no strict specification for supported baud rates.</p>
    
    <p>However, the master node (which defines the baud rate on the bus) should preferably use standard baud rates.</p>
    <h4>Limitations</h4>
    <p>Empirical testing has shown that the highest realistically achievable standard baud rate is 14'400 baud</p>
    <p>This was tested over multiple meters of cabling in a tree topology.</p>
    
    <h3>Idle state, power conservation and node wake-up</h3>
    <p>In idle state, the bus is logical high. This allows a node to detect if it is currently connected to the bus and if the bus is active.</p>
    <p>If a node is disconnected or the bus becomes inactive, the node can enter standby or power down.</p>
    <h4>Wake-Up Signal</h4>
    <p>The "RX_RAW" signal (see Interface) can be used as wake-up signal.</p> 
    <p>The output of the optocoupler being open-collector and not reliant on any auxiliary voltage supply allows for a true zero standby power consumption design.</p>
</document-page>

<document-page>
    <h3>Interface</h3>
    <img src="interface.png" width="100%">
    <p>The above diagram shows the reference implementation of the interface of a TinyBus node.</p>
    <h4>Schematic Explanation</h4>
    <p><b>Note:</b> Some of the components serve multiple purposes and are therefore reverenced multiple times.</p>
    <h5>R1, R2, D1, C1 - Protection and filtering</h5>
    <p>D1 is a transient surge arrestor. It will clamp short voltage spikes above approximatly 25V and thereby protects the following circuit.</p>
    <p>R1, R2 and C1 form a low pass filter. It dampens the high-frequency content of the signal, thereby reducing conducted electromagnetic interference (EMI).</p>
    <h5>D2, D3 - Full Bridge Rectifier</h5>
    <p>D2 and D3 form a full bridge rectifier.  This enables the polarity agnosticity of the TinyBus interface.</p>
    <h5>T1, R1,R2, R4, R5, IC2 - Transmitter</h5>
    <p>T1 in combination with IC2 forms the transmitter part of the interface.</p>
    <p>R1 and R2 limit the maximum sink current of the transmitter.</p>
    <h5>R3, D2, D3, D4, IC1 - Receiver</h5>
    <p>D2, D3, D4 and the LED of IC1 have a combined forward voltage of approximately 7.7V. This value represents the threshold between a logical high and a low. R3 limits the forward current of IC1s LED to about 6mA.</p>
</document-page>

<document-page>
    <h3>Connectors and Pinout</h3>
    <p>TinyBus devices should use a 4P4C or 4P2C modular connector (commonly, but incorrectly, often referred to as RJ-10 connector).</p>
    <p>For a bus-powered device the 4P4C modular connector must be used. For a not bus-powered device the 4P2C modular connector should be used.</p>
    <p>This allows for easy identification of bus-powered and not bus-power devices by examining the connector.</p>
    <h4>Bus Power</h4>
    <p>Voltage: TBD</p>
    <p>Max Current: TBD</p>
    <h4>Pinout</h4>
    <p>In case the 4P4C or 4P2C modular connector is used, the follwing pinout must be followed:</p>
    <table>
        <tr>
            <th>Pin</th>
            <th>Signal</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>1</td>
            <td>V- / GND</td>
            <td>Optional, for bus powerd devices</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Bus -</td>
            <td></td>
        </tr>
        <tr>
            <td>3</td>
            <td>Bus +</td>
            <td></td>
        </tr>
        <tr>
            <td>4</td>
            <td>V+</td>
            <td>Optional, for bus powered devices</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h2>Data Link Layer</h2>

    <h3>Framing</h3>
    <p>Both, the request and response, use the same frame format.</p>
    <p>The framing is based on a modified version of the "Consistent Overhead Byte Stuffing" (COBS) algorithm. 
        To enable auto baudrate detection, instead of 0 (0h), 85 (55h / 01010101b) is used as delimiter.</p>
    <p>Each frame starts and ends with the delimiter byte.</p>
    <p>Per packet, a maximum payload size of 20 bytes shall not be exceeded. Therefore, the maximum total frame lenght is 26 bytes.</p>

    <table style="border: none;">
        <tr>
            <td class="annotation_data" colspan="7">Data Link Layer (Frame)</td>
        </tr>
        <tr>
            <td  colspan="7" ></td>
        </tr>
        <tr>
            <td class="dataframe_frame">Start Byte</br>(0x55)</td>
            <td class="dataframe_frame">Overhead Byte</td>
            <td class="dataframe_data">Instruction Byte</td>
            <td class="dataframe_data">Payload</td>
            <td class="dataframe_frame">CRC16</br>(High Byte)</td>
            <td class="dataframe_frame">CRC16</br>(Low Byte)</td>
            <td class="dataframe_frame">End Byte</br>(0x55)</td>
        </tr>
        <tr>
            <td style="border: none;" colspan="2" ></td>
            <td colspan="2" ></td>
        </tr>
        <tr>
            <td colspan="2" style="border: none;"></td>
            <td class="annotation_data" colspan="2">Network Layer (Packet)</td>
        </tr>
    </table>

    <h4>Acknowledgment</h4>
    <p>Each frame sent to a specific device must be acknowledged. Broadcast frames shall not be acknowledged.</p>
    <p>The acknowledgment frame is constructed the same way as a regular data frame.</p>
    <p>The instruction byte shall be the same as it was in the request. If there is no data to be returned, the payload shall be left empty.</p>
    <h4>Non-Acknowledgment</h4>
    <p>If an error is detected in the received frame or during the execution of the request a non-acknowledgment should be returned.</p>
    <p>A non-acknowledgment uses the same frame format as an acknowledgment with the exception that the CRC shall be set to 0.</p>
    
    <h3>CRC</h3>
    <p>The CRC16 uses an x16 + x12 + x5 + 1 polynomial (0x1021) initialized to 0xFFFF.</p>

    <p>The CRC calculation includes the data contained in a network layer packet, namely the instruction byte and the payload bytes. 
        The start-byte and stop-byte as well as the overhead-byte are not included in the CRC calculation.</p>

    <h3>Automatic Baud Rate Detection</h3>
    <p>The bus baud rate is automatically detected based on the COBS delimiter byte (55h / 01010101b).</p>
    <p>The supported baud rates shall not be limited to standard baud rates.</p>
    <p>The baud rate detection may be done only once at device startup and does not need to be repeted for each frame.</p>
</document-page>

<document-page>
    <h2>Network Layer</h2>
    <p>Each packet contains an instruction and a payload.</p>

    <table style="border: none;">
        <tr>
            <td class="annotation_data" colspan="2">Network Layer (Packet)</td>
        </tr>
        <tr>
            <td colspan="2" ></td>
        </tr>
        <tr>
            <td class="dataframe_frame" width="25%">Instruction Byte</td>
            <td class="dataframe_data">Payload</td>
        </tr>
        <tr>
            <td style="border: none;"></td>
            <td colspan="1" ></td>
        </tr>
        <tr >
            <td style="border: none;" ></td>
            <td class="annotation_data" colspan="1">Application Layer (Message)</td>
        </tr>
    </table>

    <h3>Instruction Byte</h3>
    <table>
        <tr>
            <th colspan="8">Instruction Byte</th>
        </tr>
        <tr>
            <td colspan="4">Address (Upper Nibble)</td>
            <td colspan="4">Command (Lower Nibble)</td>
        </tr>
    </table>
    <p>The instruction byte is split into two parts: the address (upper nibble) and the command (lower nibble).</p>

    <h4>Addressing</h4>
    <p>The 4-bit address range allows for addresses between 0 (0h) and 15 (Fh).</p>
    <ul>
        <li>15 (Fh) is reserved as a broadcast address and cannot be used as an individual device address.</li>
        <li>0 (0h) is the default address of an unconfigured device and should not be used in an installation.</li>
    </ul>
    <p>The remaining address range of 1 (1h) to 14 (Eh) can be assigned freely.</p>

    <h4>Commands</h4>

    <p>The command ids 0-14 (0h-Eh) are application specific. For details on those commands see the respective application documentation.</p>
    <p>The command 15 (Fh) is reserved for kernel communication.</p>

    <table>
        <tr>
            <th>Command Id</th>
            <th>Command</th>
            <th>Payload</th>
            <th>Reply (1)</th>
        </tr>
        <tr>
            <td>0-14</td>
            <td>Application Specific</td>
            <td>Application Specific</td>
            <td>Application Specific</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Kernel Commands</td>
            <td>Subcommand Specific</td>
            <td>Subcommand Specific</td>
        </tr>
    </table>
    <p>1) Only if individual addressed, broadcast messages get no reply.</p>

</document-page>

<document-page>
    <h2>Application Layer</h2>

    <h4>Starting the application</h4>
    <p>The application will only start if the application CRC is valid.</p> 
    
    <h5>Application Autostart Disabled</h5>
    <p>The device will not run the application until either the "Start App" kernel command or a command other than a kernel command (Command Id 15) is received. 
        Any application command (Command Id 0-14) will start the application.</p>
    
    <h5>Application Autostart Enabled</h5>
    <p>The device will run the application automatically as soon as the device is powerd-on.</p>
    <p>In case a device reset is triggered due to a watchdog timeout, division-by-zero error, or similar the application should not autostart.</p>

    <h4>Stopping the application</h4>
    <p>To stop the execution of the application the "Stop App" kernel command can be sent.</p>
</document-page>

<document-page>
    <h3>Application Header</h3>

    <table style="table-layout : fixed; border: none;">
        <tr>
            <td style="border: none;"></td>
            <th style="width: 4%;">Bit</th>
            <th>7</th>
            <th>6</th>
            <th>5</th>
            <th>4</th>
            <th>3</th>
            <th>2</th>
            <th>1</th>
            <th>0</th>
        </tr>
        <tr>
            <th>Byte</th>
        </tr>
        <tr>
            <th>0</th>
            <td style="border: none;"></td>
            <td>Autostart</td>
            <td colspan="5">Reserved</td>
            <td colspan="2">Header Version</td>
        </tr>
        <tr>
            <th>1</th>
            <td style="border: none;"></td>
            <td colspan="8">Reserved</td>
        </tr>
        <tr>
            <th>2</th>
            <td style="border: none;"></td>
            <td colspan="8">Major Firmware Version</td>
        </tr>
        <tr>
            <th>3</th>
            <td style="border: none;"></td>
            <td colspan="8">Minor Firmware Version</td>
        </tr>
        <tr>
            <th>4</th>
            <td style="border: none;"></td>
            <td colspan="8">Hardware Id (High)</td>
        </tr>
        <tr>
            <th>5</th>
            <td style="border: none;"></td>
            <td colspan="8">Hardware Id (Low)</td>
        </tr>
        <tr>
            <th>6</th>
            <td style="border: none;"></td>
            <td colspan="8">Major Hardware Version</td>
        </tr>
        <tr>
            <th>7</th>
            <td style="border: none;"></td>
            <td colspan="8">Minor Hardware Version</td>
        </tr>
        <tr>
            <th>8-13</th>
            <td style="border: none;"></td>
            <td colspan="8">Reserved</td>
        </tr>
        <tr>
            <th>14-31</th>
            <td style="border: none;"></td>
            <td colspan="8">Application Name</td>
        </tr>
    </table>

    <p></p>
    <h4>Autostart</h4>
    <p>If this bit is set, the application starts automatically on power-up</p>

    <h4>Minor Version</h4>
    <p></p>

    <h4>Major Version</h4>
    <p></p>

    <h4>Application Name</h4>
    <p></p>

</document-page>


<document-page>

    <h3>Kernel Communication</h3>
    <p>Each kernel command message is composed of a subcommand id and a payload.</p>
    <table>
        <tr>
            <td class="annotation_data" colspan="2">Application Layer (Message)</td>
        </tr>
        <tr>
            <td colspan="2" ></td>
        </tr>
        <tr>
            <td class="dataframe_frame" width="25%">Kernel Subcommand Id</td>
            <td class="dataframe_data">Payload</td>
        </tr>
    </table>

    <p><b>Note:</b> In the response the most signifcant bit of the sub command id is set.</p>

    <h4>Subcommands</h4>
    <table>
        <tr>
            <th>Id</th>
            <th>Name</th>
            <th>Payload</th>
            <th>Reply</th>
        </tr>
        <tr>
            <td>0</td>
            <td>Get Device State</td>
            <td>Empty</td>
            <td>Device State</td>
        </tr>
        <tr>
            <td>1</td>
            <td>Get Hardware Information</td>
            <td>Empty</td>
            <td>Hardware Information</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Get Memory Information</td>
            <td>Empty</td>
            <td>Memory Information</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Get App CRC</td>
            <td>Empty</td>
            <td>CRC of app sector</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Erase App Section</td>
            <td>Empty</td>
            <td>Acknowledgment</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Write Page</td>
            <td>Write Address + Data</td>
            <td>Acknowledgment</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Write EEPROM</td>
            <td>Page Address + Page Data</td>
            <td>Acknowledgment</td>
        </tr>
        <tr>
            <td>7</td>
            <td>Read EEPROM</td>
            <td>Byte Address + Read Size</td>
            <td>EEPROM Data</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Read RAM</td>
            <td>Byte Address + Read Size</td>
            <td>RAM Data</td>
        </tr>
        <tr>
            <td colspan="4" ></td>
        </tr>
        <tr>
            <td>10</td>
            <td>Reboot</td>
            <td>Empty</td>
            <td>None</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Start App</td>
            <td>Empty</td>
            <td>Acknowledgment</td>
        </tr>
        <tr>
            <td>12</td>
            <td>Stop App</td>
            <td>Empty</td>
            <td>Acknowledgment</td>
        </tr>
        <tr>
            <td>13</td>
            <td>Get Application Name</td>
            <td>Empty</td>
            <td>Application Name</td>
        </tr>
        <tr>
            <td>14</td>
            <td>Get Application Version</td>
            <td>Empty</td>
            <td>Application Version</td>
        </tr>
        <tr>
            <td>15</td>
            <td>Set Address</td>
            <td>New Address</td>
            <td>Acknowledgment</td>
        </tr>
    </table>

</document-page>

<document-page>
    <h3>Command 0x00 - <span>Get Device State</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Empty</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Device State / non-acknowledgment</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>This command will return a device state message.</p>

    <h4>Device State Message</h4>

    <table>
        <tr>
            <th>Index</th>
            <th>Data</th>
            <th>Size in Bytes</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0:7-4</td>
            <td>Device Address</td>
            <td>0.5</td>
            <td>The address of the device</td>
        </tr>
        <tr>
            <td>0:3-0</td>
            <td>Device State</td>
            <td>0.5</td>
            <td>The state of the device</td>
        </tr>
    </table>

    <h4>Device State</h4>
    <p>The device state is a 4 bit number, representing the current state of the device.</p>
    <table>
        <tr>
            <th>Index</th>
            <th>State</th>
            <th>Description</th>
        </tr>
        <tr>
            <td>0</td>
            <td>Unknown</td>
            <td>The current device state is unknown</td>
        </tr>
        <tr>
            <td>1</td>
            <td>Checking CRC</td>
            <td>The CRC calculation is currently running</td>
        </tr>
        <tr>
            <td>2</td>
            <td>CRC error</td>
            <td>The application CRC is invalid</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Application start</td>
            <td>The application is starting</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Application running</td>
            <td>The application is running</td>
        </tr>
        <tr>
            <td>5</td>
            <td>Application shutdown</td>
            <td>The application is shutting down</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Application stopped</td>
            <td>The application is stopped</td>
        </tr>
        <tr>
            <td>7</td>
            <td>Reserved</td>
        </tr>
        
    </table>
</document-page>

<document-page>
    <h3>Command 0x01 - <span>Get Hardware Information</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Empty</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Hardware Information / non-acknowledgment</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>This command will return the hardware information table.</p>

    
    <h4>Hardware  Information</h4>
    <table>
        <tr>
            <th>Index</th>
            <th>Data</th>
            <th>Size in Bytes</th>
            <th>Description</th>
        </tr>

        <tr>
            <td>0-1</td>
            <td>Controller Id</td>
            <td>2</td>
            <td>Controller Id. See Processor Id Table</td>
        </tr>
        <tr>
            <td>2-3</td>
            <td>Hardware Id</td>
            <td>2</td>
            <td></td>
        </tr>
        <tr>
            <td>4</td>
            <td>Major Hardware Revision</td>
            <td>1</td>
            <td></td>
        </tr>
        <tr>
            <td>5</td>
            <td>Minor Hardware Revision</td>
            <td>1</td>
            <td></td>
        </tr>
        <tr>
            <td>6</td>
            <td>Major Kernel Revision</td>
            <td>1</td>
            <td></td>
        </tr>
        <tr>
            <td>7</td>
            <td>Minor Kernel Revision</td>
            <td>1</td>
            <td></td>
        </tr>
    </table>

    <h3>Command 0x02 - <span>Get Memory Information</h3>
        <table class='protocol'>
            <tr class='protocol'>
                <th class='protocol'>Payload</th>
                <td class='protocol'>Empty</td>
            </tr>
            <tr class='protocol'>
                <th class='protocol'>Reply</th>
                <td class='protocol'>Memory Information / non-acknowledgment</td>
            </tr>
            <tr class='protocol'>
                <th class='protocol'>Error Handling</th>
                <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
            </tr>
        </table>
        <p>This command will return the memory information table.</p>
    
        <h4>Memory Information</h4>
        <table>
            <tr>
                <th>Index</th>
                <th>Data</th>
                <th>Size in Bytes</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>0-1</td>
                <td>Flash size</td>
                <td>2</td>
                <td>Flash size in bytes</td>
            </tr>
            <tr>
                <td>2-3</td>
                <td>Application start</td>
                <td>2</td>
                <td>Flash application sector start address in bytes</td>
            </tr>
            <tr>
                <td>4</td>
                <td>Flash Page Size</td>
                <td>1</td>
                <td>Size of one flash page in bytes</td>
            </tr>
            <tr>
                <td>5-6</td>
                <td>RAM Size</td>
                <td>2</td>
                <td>Size of the RAM in bytes</td>
            </tr>
            <tr>
                <td>7-8</td>
                <td>RAM application start</td>
                <td>2</td>
                <td>RAM application sector start address</td>
            </tr>
            <tr>
                <td>9-10</td>
                <td>EEPROM Size</td>
                <td>2</td>
                <td>Size of the EEPROM in bytes</td>
            </tr>
            <tr>
                <td>11-12</td>
                <td>EEPROM application start</td>
                <td>2</td>
                <td>EEPROM application sector start address</td>
            </tr>
        </table>
</document-page>

<document-page>
    <h3>Command 0x03 - Get Application CRC</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Empty</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>CRC of the application flash section / non-acknowledgment</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>This command will calculate the CRC of the application memory section and return it.</p>

    <h3>Command 0x04 - <span>Erase App Section</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Empty</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Acknowledgment</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>This command will erase the application sector of the target device. 
        If the application is running, it will be stopped. 
        After the erasing process is successfully completed, the target device will reply with an acknowledgment. 
        If the erasing process fails, the target will reply with a non-acknowledgment.</p>

    <h3>Command 0x05 - Write Page</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Page Address + Page Data</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Acknowledgment</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>The application image is transferred in 16-Byte junks. Shorter frames must be padded with 255 (FFh).</p>
    <table>
        <tr>
            <th>Byte</th>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
            <th>8</th>
            <th>9</th>
            <th>10</th>
            <th>11</th>
            <th>12</th>
            <th>13</th>
            <th>14</th>
            <th>15</th>
            <th>16</th>
            <th>17</th>
        </tr>
        <tr>
            <th>Data</th>
            <td colspan="2" >16 Bit Word Address</td>
            <td colspan="16" >Databyte 0 - 15</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h3>Command 0x06 - Write EEPROM</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Address + Data</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Acknowledgment</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>The EEPROM data can be transferred in 1 - 16 byte junks. Unused bytes shall not be transmitted.</p>
    <table>
        <tr>
            <th>Byte</th>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
            <th>8</th>
            <th>9</th>
            <th>10</th>
            <th>11</th>
            <th>12</th>
            <th>13</th>
            <th>14</th>
            <th>15</th>
            <th>16</th>
            <th>17</th>
        </tr>
        <tr>
            <th>Data</th>
            <td colspan="2" >16 Bit Byte Address</td>
            <td colspan="16" >Databyte 0 - 15</td>
        </tr>
    </table>

    <h3>Command 0x07 - Read EEPROM</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Address + Size</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>EEPROM Data</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>The EEPROM data can be requested in 1-16 byte junks. Unused bytes shall not be transmitted.</p>
    <table>
        <tr>
            <th>Byte</th>
            <th>0</th>
            <th>1</th>
            <th>2</th>

        </tr>
        <tr>
            <th>Data</th>
            <td colspan="2">16 Bit Address</td>
            <td colspan="1">Size</td>
        </tr>
    </table>
    <p><b>Reply</b></p>
    <table>
        <tr>
            <th>Byte</th>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
            <th>8</th>
            <th>9</th>
            <th>10</th>
            <th>11</th>
            <th>12</th>
            <th>13</th>
            <th>14</th>
            <th>15</th>
        </tr>
        <tr>
            <th>Data</th>
            <td colspan="16" >Databyte 0 - 15</td>
        </tr>
    </table>

    <h3>Command 0x08 - Read RAM</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Address + Size</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>RAM Data</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>The RAM data can be requested in 1-16-Byte junks. Unused bytes shall not be transmitted.</p>
    <table>
        <tr>
            <th>Byte</th>
            <th>0</th>
            <th>1</th>
            <th>2</th>

        </tr>
        <tr>
            <th>Data</th>
            <td colspan="2">16 Bit Address</td>
            <td colspan="1">Size</td>
        </tr>
    </table>
    <p><b>Reply</b></p>
    <table>
        <tr>
            <th>Byte</th>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
            <th>8</th>
            <th>9</th>
            <th>10</th>
            <th>11</th>
            <th>12</th>
            <th>13</th>
            <th>14</th>
            <th>15</th>
        </tr>
        <tr>
            <th>Data</th>
            <td colspan="16" >Databyte 0 - 15</td>
        </tr>
    </table>
</document-page>

<document-page>
    <h3>Command 0x0A - Reboot</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Empty</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>None</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>This command will restart the device. This should be accomplished via a hardware reset of the device.
       If a hardware-reset can not be triggered via software, it is sufficient to jump to the boot vector of the device.</p>
    
    <p><strong>Note:</strong> The application will not be shutdown! Peripherals may stay initialized.</p>

    <h3>Command 0x0B - Start App</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Empty</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Acknowledgment</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>This command will verify the CRC of the application and, in case of a valid CRC, start the application.</p>

    <h3>Command 0x0C - Stop App</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Empty</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Acknowledgment</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>This command will shutdown the application.</p>
</document-page>

<document-page>
    <h3>Command 0x0D - Get Application Name</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Empty</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Application Name</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>In case of a valid CRC, this command will return the application name. Otherwise, a non-acknowledgment is returned.</p>
    <p>The application name lenght can be between 1-18 bytes. Unused bytes are not transmitted.</p>
    <p><b>Reply</b></p>
    <table>
        <tr>
            <th>Byte</th>
            <th>0</th>
            <th>1</th>
            <th>2</th>
            <th>3</th>
            <th>4</th>
            <th>5</th>
            <th>6</th>
            <th>7</th>
            <th>8</th>
            <th>9</th>
            <th>10</th>
            <th>11</th>
            <th>12</th>
            <th>13</th>
            <th>14</th>
            <th>15</th>
            <th>16</th>
            <th>17</th>
        </tr>
        <tr>
            <th>Data</th>
            <td colspan="18" >Application Name</td>
        </tr>
    </table>

    <h3>Command 0x0E - Get Application Version</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>Empty</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Application Version</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    <p>In case of a valid CRC, this command will return the application version. Otherwise, a non-acknowledgment is returned.</p>

    <p><b>Reply</b></p>
    <table>
        <tr>
            <th>Byte</th>
            <th>0</th>
            <th>1</th>
        </tr>
        <tr>
            <th>Data</th>
            <td>Major Firmware Revision</td>
            <td>Minor Firmware Revision</td>
        </tr>
    </table>

    <h3>Command 0x0F - Set Address</h3>
    <table class='protocol'>
        <tr class='protocol'>
            <th class='protocol'>Payload</th>
            <td class='protocol'>New Address</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Reply</th>
            <td class='protocol'>Acknowledgment</td>
        </tr>
        <tr class='protocol'>
            <th class='protocol'>Error Handling</th>
            <td class='protocol'>If the command exicution fails, a non-acknowledgment will be replied.</td>
        </tr>
    </table>
    
    <p>This command changes the current device address to a new address. </p>
    <p>Valid addresses are 1-14 (01h - 0Eh)</p>
    <p><strong>Note: </strong>The address change will become effective after a device reboot.</p>

</document-page>
    
</div>
</body>